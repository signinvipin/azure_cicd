Setup VM for Azure Classic Pipeline:
------------------------------------

Create vm with arm64 architecture and centOS

Update centOS
sudo yum update -y

install java-17-devel
sudo yum install java-17-devel
Verify 
java --version
javac -version

Install maven

maven download link
https://maven.apache.org/download.cgi

curl -O https://dlcdn.apache.org/maven/maven-3/3.9.11/binaries/apache-maven-3.9.11-bin.tar.gz

setup goals
mvn clean package -DskipTests

Install Git
sudo yum install git

Download & setup az-agent
curl -L https://download.agent.dev.azure.com/agent/4.261.0/vsts-agent-linux-arm64-4.261.0.tar.gz -o vsts-agent-linux-arm64-4.261.0.tar.gz

Install Docker
sudo dnf config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo
sudo dnf install docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin
sudo systemctl enable docker

add user to docker group
sudo usermod -aG docker azureuser

Setup agent on VM
sudo curl -O 
sudo -zxvf 
sudo ./bin/installdependencies.sh
./config.sh
https://dev.azure.com/third8devops
pool name - az-classic-pool

./run.sh

On portal azure

Create cluster and service connection:
--------------------------------------
Github
Docker
Azure Resource Manager
kubernetes

Configure Classic Editor Tasks:
-------------------------------
Pipeline - Build pipeline > Agent pool - az-classic-pool
Parameters - Maven POM file - pom.xml
Get source - GitHub > select repository and branch to pull code

Under Agent
> Add Maven task
  Goals - clean package -DskipTests

> Add Docker task
  Add Docker Build and Push Task
  Command: buildAndPush
  Tags: $(Build.BuildId),latest
  #This will push same image with same digest to docker repository
*for 3.2.3 like versioning - change above

> Add kubectl task
  command: rollout
  service connection: Kubernetes Service Connection
  Kubernetes service connection: az-classic-cluster-conn
  Arguments: restart deployment java-app --namespace default

> Add kubectl task
##latest tag in app-deployment.yaml is typically used in development/testing for convenience.
  command: apply
  Arguments: -f app-deployment-dev-test.yaml

for production, include below step in above steps:
####Versioned tags are preferred in production for traceability and immutability.
after docker build and push, 
> Add bash script/powershell script as,

sed -i "s|image: signinvipin/az-classic-pipeline:.*|image: signinvipin/az-classic-pipeline:$(Build.BuildId)|" app-deployment-prod.yaml

** Learn -
 Templating tools (e.g., Helm) - At scale in production - Used for complex apps or multiple environments
**






